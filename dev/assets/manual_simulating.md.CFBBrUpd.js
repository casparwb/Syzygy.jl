import{_ as l,c as t,o as n,aA as a,j as s,a as e}from"./chunks/framework.CCzQAQQF.js";const E=JSON.parse('{"title":"Simulating systems","description":"","frontmatter":{},"headers":[],"relativePath":"manual/simulating.md","filePath":"manual/simulating.md","lastUpdated":null}'),h={name:"manual/simulating.md"},o={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},p={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.05ex"},xmlns:"http://www.w3.org/2000/svg",width:"7.683ex",height:"2.022ex",role:"img",focusable:"false",viewBox:"0 -871.8 3396 893.8","aria-hidden":"true"};function r(d,i,k,c,g,y){return n(),t("div",null,[i[8]||(i[8]=a(`<h1 id="Simulating-systems" tabindex="-1">Simulating systems <a class="header-anchor" href="#Simulating-systems" aria-label="Permalink to &quot;Simulating systems {#Simulating-systems}&quot;">​</a></h1><h2 id="Simulation-setup" tabindex="-1">Simulation setup <a class="header-anchor" href="#Simulation-setup" aria-label="Permalink to &quot;Simulation setup {#Simulation-setup}&quot;">​</a></h2><p>Once the system has been initialized, you can set up the parameters of the n-body simulation using the <code>simulation</code> function, which takes in the system as the first and only positional argument, followed by keyword arguments for all the other properties. <code>simulation</code> accepts almost any argument supported by the common solver options of the <code>solve</code> function from <a href="https://diffeq.sciml.ai/" target="_blank" rel="noreferrer">DifferentialEquations.jl</a>. See the <a href="https://docs.sciml.ai/DiffEqDocs/stable/basics/common_solver_opts/#solver_options" target="_blank" rel="noreferrer">Docs</a> for a full overview. Note that solvers are not re-exported, thus they can be specified with the <code>Syzygy</code> prefix, like <code>Syzygy.DPRKN6()</code>.</p><div class="warning custom-block"><p class="custom-block-title">Missing docstring.</p><p>Missing docstring for <code>Syzygy.simulation</code>. Check Documenter&#39;s build log for details.</p></div><p>&lt;!– ### Important keyword arguments</p><ul><li><p><code>t_sim</code>: total simulation time, which can either be a <code>Number</code>, in which case the simulation time will be <code>t_sim</code> multiplied by the period of the outermost binary, or it can be a <code>Quantity</code>, i.e., a number with a (time) unit, in which case the simulation time is simply <code>t_sim</code>.</p></li><li><p><code>npoints</code>: See section on Saving controls.</p></li><li><p><code>saveat</code>: See section on Saving controls.</p></li><li><p><code>save_every</code>: See section on Saving controls.</p></li><li><p><code>alg</code>: the solver to use. Default is the 8-th order Runge-Kyutta-Nyström method as described in the DiffEq 2nd order ODE solver <a href="https://docs.sciml.ai/DiffEqDocs/stable/solvers/dynamical_solve/" target="_blank" rel="noreferrer">docs</a>. This is an adaptive solver, thus the only solver arguments are the absolute and relative error tolerances, which can be set using <code>abs_tol</code> and <code>rel_tol</code> respectively. By default they are both set to <code>1e-10</code>.</p></li><li><p><code>dt</code>: time step. Only used if the solver is not adaptive, such as <code>VerletLeapfrog</code>, <code>McAte5</code>, <code>Yoshida6</code>, etc.. Can either be a <code>Real</code> or a <code>Quantity</code>, where a <code>Real</code> would specify a timestep equal to <code>dt</code> multiplied by the innermost orbital period.</p></li><li><p><code>showprogress</code>: whether to display a progress tracker, showing the current absolute system time and its percentage of <code>t_sim</code>. Will slow down the simulation.</p></li><li><p><code>verbose</code>: whether to output information about the setup and the final outcome, including total runtime and energy loss.</p></li><li><p><code>max_cpu_time</code>: Maximum amount of CPU time a simulation should run. Default is Inf.</p></li><li><p><code>callbacks</code>: see section on callbacks.</p></li><li><p><code>potential</code>: see section on potentials. –&gt;</p></li></ul><h3 id="Examples" tabindex="-1">Examples <a class="header-anchor" href="#Examples" aria-label="Permalink to &quot;Examples {#Examples}&quot;">​</a></h3><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sim </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> simulation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(triple, t_sim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, npoints</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10_000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># simulate for 10 outer orbits, and save 10 000 snapshots uniformly distributed</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sim </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> simulation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(triple, t_sim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, saveat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;d&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># save 1 day</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sim </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> simulation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(triple, t_sim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, save_every</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># save every 10th timestep</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sim </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> simulation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(triple, t_sim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;kyr&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, save_everystep</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># simulate for 10 000 years, and only save the initial and final state of the system</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sim </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> simulation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(triple, t_sim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, alg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Syzygy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">McAte5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), dt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1e-5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># use a timestep of 1e-5 * P_in</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sim </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> simulation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(triple, t_sim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, alg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Syzygy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">McAte5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), dt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;s&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># use a timestep of 1 second</span></span></code></pre></div><h2 id="Saving-controls" tabindex="-1">Saving controls <a class="header-anchor" href="#Saving-controls" aria-label="Permalink to &quot;Saving controls {#Saving-controls}&quot;">​</a></h2><p>Syzygy provides flexibility in how to save the output of a simulation. By default, the solver takes a snapshot at each time step. The output will also be dense, meaning you can interpolate into new time points. To set other saving options, you can send the following keyword arguments to <code>simulation</code>:</p><ul><li><p><code>npoints</code>: number of snapshots to save. With this parameter, a snapshot will be taken every <code>(t_end - t_start)/npoints</code>, and will therefore be uniformly distributed in time.</p></li><li><p><code>saveat</code>: Times at which to save a snapshot. If given as a number with a time unit, a snapshot will be taken every <code>saveat</code>. If given as an array, a snapshot will be taken at those times.</p></li><li><p><code>save_every</code>: Specify that you want to save a snapshot every <code>save_every</code>-th time step. A value of e.g. 2 will save a snapshot every 2nd time step.</p></li><li><p><code>save_everystep</code>: If <code>false</code>, only save the initial and final steps of the solution, otherwise save every step. Default is <code>true</code>.</p></li></ul><h2 id="Callbacks" tabindex="-1">Callbacks <a class="header-anchor" href="#Callbacks" aria-label="Permalink to &quot;Callbacks {#Callbacks}&quot;">​</a></h2><p>The package contains several pre-defined callbacks that can be specified when setting up the simulation. These mostly define stopping conditions, but can also be e.g, flags or events. Callbacks can be specified using the <code>callbacks</code> keyword argument when calling <code>simulation</code>, and be given as a <code>Vector{&lt;:AbstractSyzygyCallback}</code>. There are number of pre-defined callbacks, but you can also define your own. (see Advanced usage for more details). Some of the more important pre-defined callbacks are:</p><ul><li><p><code>CollisionCB</code>: a stopping condition that terminates the integration when two objects gets close enough. The exact condition for specifying a collision depends on the stellar types of the objects. If the two objects are both stars, then the code simply checks if the radii overlap. If the objects are stellar remnants (black holes, neutron stars, white dwarfs), then the code checks if the distance is smaller than some multiple of their mutual gravitational radius. By default, this multiple value is set to 10000. If the two objects contain one star and one remnant, then the code checks if the star is within the tidal disruption radius of the remnant object.</p></li><li><p><code>EscapeCB</code>: a stopping condition for checking whether an object has been ejected from the system. The callback has three checks that need to be passed in order for the condition to be invoked. See Standish &amp; Myles 1971 for more details. Currently this callback is only possible to use for a triple system.</p></li></ul><p>Certain callbacks accept arguments when instantiating them. This can include how often the solver should check for the condition (for every n-th step). This is implemented as the field <code>check_every</code>.</p><h3 id="Examples-2" tabindex="-1">Examples <a class="header-anchor" href="#Examples-2" aria-label="Permalink to &quot;Examples {#Examples-2}&quot;">​</a></h3><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">callbacks </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CollisionCB</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10_000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">EscapeCB</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sim </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> simulation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(system, t_sim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, callbacks</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">callbacks)</span></span></code></pre></div><h2 id="Potentials" tabindex="-1">Potentials <a class="header-anchor" href="#Potentials" aria-label="Permalink to &quot;Potentials {#Potentials}&quot;">​</a></h2><p><code>Syzygy.jl</code> has support for including/varying the potentials and corresponding acceleration functions in a simulation. In this package, you can specify the acceleration functions to include by setting the <code>potential</code> keyword argument when calling <code>simulate</code> or <code>simulation</code>. This argument accepts a <code>Vector{MultiBodyPotential}</code> where <code>MultiBodyPotential</code> is a supertype of all the potentials defined in the package, and for each of which there exists a unique acceleration function. The total acceleration of a particle at each time step is thus a sum of all the acceleration functions defined by the <code>potential</code> vector.</p><p>Currently, there are a number of possible potentials:</p><ul><li><p><code>PureGravitationalAcceleration</code>: Newtonian gravitational acceleration</p></li><li><p><code>DynamicalTidalAcceleration</code>: energy dissipation from dynamical tides, following the prescription of <a href="http://arxiv.org/abs/1803.08215" target="_blank" rel="noreferrer">Samsing et al. 2018</a>.</p></li><li><p><code>EquilibriumTidalAcceleration</code>: tidal drag force from equilibrium tides, as described by <a href="http://arxiv.org/abs/astro-ph/0201220" target="_blank" rel="noreferrer">Hurley at al. 2002</a>, using the model of <a href="https://ui.adsabs.harvard.edu/abs/1981A&amp;A....99..126H" target="_blank" rel="noreferrer">Hut 1981</a>.</p></li><li><p><code>TimeDependentEquilbriumTidalAcceleration</code>: same as above, but with the assumption that masses, radii, and other structural parameters of the particles can change during the simulation, which means that structural properties such as envelope mass and radius are calculated during the simulation.</p></li></ul><p>There are also potentials for various general relatistic effects via post-Newtonian expansion. See the following section on post-Newtonian physics.</p><p>Each of these accepts a specific set of arguments related to the acceleration functions. To get an overview of these, enter the <code>help</code>-mode in the REPL with <code>?</code> and type any of the above names.</p><div class="tip custom-block"><p class="custom-block-title">Important</p><p>The numerical implementation of potentials and acceleration functions in this package is heavily inspired by or completely taken from <a href="https://github.com/SciML/NBodySimulator.jl" target="_blank" rel="noreferrer">NbodySimulator.jl</a>. Credit go the authors.</p></div><h3 id="Example" tabindex="-1">Example <a class="header-anchor" href="#Example" aria-label="Permalink to &quot;Example {#Example}&quot;">​</a></h3><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">grav_pot </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> PureGravitationalAcceleration</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tidal_pot </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> DynamicalTidalAcceleration</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(;kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">res </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> simulate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(system, potential</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[grav_pot, tidal_pot])</span></span></code></pre></div><h2 id="Post-Newtonian-expansion" tabindex="-1">Post-Newtonian expansion <a class="header-anchor" href="#Post-Newtonian-expansion" aria-label="Permalink to &quot;Post-Newtonian expansion {#Post-Newtonian-expansion}&quot;">​</a></h2><p>For systems where general relativistic effects can become important, <code>Syzygy.jl</code> supports post-Newtonian acceleration potentials up to order 2.5, following the formalism of <a href="http://arxiv.org/abs/1310.1528" target="_blank" rel="noreferrer">Blanchet 2015</a>.</p><ul><li><p><code>PN1Potential</code>: post-Newtonian acceleration of order 1.</p></li><li><p><code>PN2Potential</code>: post-Newtonian acceleration of order 2.</p></li><li><p><code>PN2p5Potential</code>: post-Newtonian acceleration of order 2.5.</p></li><li><p><code>PNPotential</code>: post-Newtonian acceleration of order 1 to 2.5. This is more efficient than including all of the above potentials individually.</p></li></ul><div class="tip custom-block"><p class="custom-block-title">Note</p><p>The default ODE algorithm (<code>DPRKN8</code>) does not support velocity-dependent potentials, and will therefore not produce correct trajectories when simulating system with post-Newtonian terms. Other algorithms that do support velocity dependent potentials are <code>Vern7</code>, <code>Vern8</code>, <code>Vern9</code>, and <code>FineRKN5</code>.</p></div><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sim </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> simulation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(system, potential</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">PureGravitationalPotential</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                                    PNPotential</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()], </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        alg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Syzygy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">FineRKN5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span></code></pre></div><h2 id="Running-a-simulation" tabindex="-1">Running a simulation <a class="header-anchor" href="#Running-a-simulation" aria-label="Permalink to &quot;Running a simulation {#Running-a-simulation}&quot;">​</a></h2><p>Once the simulation has been instantiated, it can be run using <code>simulate(sim)</code>. You can also skip the previous step and directly call <code>simulate</code> with the exact same arguments as for <code>simulation</code>.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">res </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> simulate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(triple, t_sim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, npoints</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h2 id="Analysis-and-visualization" tabindex="-1">Analysis and visualization <a class="header-anchor" href="#Analysis-and-visualization" aria-label="Permalink to &quot;Analysis and visualization {#Analysis-and-visualization}&quot;">​</a></h2><p>Once a simulation has finished, it can be analyzed and converted to a <code>MultiBodySolution</code> type, which allows for easy access to the state vectors and other parameters. This is done using the <code>to_solution</code> function, which only takes in the resulting output from <code>simulate</code> as its argument. In the <code>MultiBodySolution</code> type, the state vectors are stored in 3-dimensional <code>AxisArray</code> from <a href="https://github.com/JuliaArrays/AxisArrays.jl" target="_blank" rel="noreferrer">AxisArrays.jl</a>, with the axes being (dimension, particle, time).</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sol </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> to_solution</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(res)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">N </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sol</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">t)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">r1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sol</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">r[particle</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># a (3, N) array, alias for sol.r[:,1,:]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">v1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sol</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">v[particle</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><p><code>Syzygy.jl</code> contains a few plot recipes for <a href="https://docs.juliaplots.org/latest/tutorial/" target="_blank" rel="noreferrer">Plots.jl</a>, which can be used to create quick and simple visualizations of the orbits. To use this, simply import <code>Plots.jl</code>, and use the function <code>orbitplot</code>, which takes in a <code>MultiBodySolution</code> as its first argument, followed by keyword arguments:</p><ul><li><p><code>dims</code>: which dimensions to plot. Should be a <code>Vector{Int}</code>, with any combination of <code>(1, 2, 3)</code> (x, y, z).</p></li><li><p><code>bodies</code>: which bodies (particles) to plot. Should be a <code>Vector{Int}</code>, with any combination of <code>1:N_particles</code>.</p></li><li><p><code>tspan</code>: the temporal selection to plot. Should be a <code>Tuple{Quantity, Quantity}</code>, with the start- and end-points.</p></li></ul><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Plots</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">orbitplot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sol, bodies</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], dims</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># plot only particles 1 and 2 in the x-y plane</span></span></code></pre></div><h2 id="Higher-precision" tabindex="-1">Higher precision <a class="header-anchor" href="#Higher-precision" aria-label="Permalink to &quot;Higher precision {#Higher-precision}&quot;">​</a></h2>`,41)),s("p",null,[i[2]||(i[2]=e("By default ")),i[3]||(i[3]=s("code",null,"Syzygy.jl",-1)),i[4]||(i[4]=e(" uses ")),i[5]||(i[5]=s("code",null,"Float64",-1)),i[6]||(i[6]=e(" datatypes for the variables of integration, which means that we can not set the error tolerances for the ODE solver lower than ")),s("mjx-container",o,[(n(),t("svg",p,i[0]||(i[0]=[a('<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="223C" d="M55 166Q55 241 101 304T222 367Q260 367 296 349T362 304T421 252T484 208T554 189Q616 189 655 236T694 338Q694 350 698 358T708 367Q722 367 722 334Q722 260 677 197T562 134H554Q517 134 481 152T414 196T355 248T292 293T223 311Q179 311 145 286Q109 257 96 218T80 156T69 133Q55 133 55 166Z" style="stroke-width:3;"></path></g><g data-mml-node="msup" transform="translate(1055.8,0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" style="stroke-width:3;"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500,0)" style="stroke-width:3;"></path></g><g data-mml-node="TeXAtom" transform="translate(1033,393.1) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z" style="stroke-width:3;"></path></g><g data-mml-node="mn" transform="translate(778,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" style="stroke-width:3;"></path><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" transform="translate(500,0)" style="stroke-width:3;"></path></g></g></g></g></g>',1)]))),i[1]||(i[1]=s("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("mo",null,"∼"),s("msup",null,[s("mn",null,"10"),s("mrow",{"data-mjx-texclass":"ORD"},[s("mo",null,"−"),s("mn",null,"14")])])])],-1))]),i[7]||(i[7]=a(' (see <a href="https://docs.sciml.ai/DiffEqDocs/stable/basics/faq/#How-to-get-to-zero-error" target="_blank" rel="noreferrer">DiffEq docs</a>). While this is generally pretty good, for longer simulation times or systems with very close passages, this might not be enough. Therefore, <code>Syzygy.jl</code> supports higher and arbitracy arithmetic, which means you can essentially get as small error as you want tT the cost of speed. This is done through the (DoubleFloats.jl)[] and (ArbNumerics.jl)[] packages. You get the best performance using the <code>Double64</code> type from the former package, which has twice the precision of <code>Float64</code>s. If you need even higher precision, you can use the arbitrary precision floating point numbers from (ArbNumerics.jl)[<a href="https://github.com/JeffreySarnoff/ArbNumerics.jl" target="_blank" rel="noreferrer">https://github.com/JeffreySarnoff/ArbNumerics.jl</a>]. However, using these will dramatically slow down the code. To use this functionality, simply specify the <code>precision</code> keyword when calling either <code>simulation</code> or <code>simulate</code>. Fixed-bit types are specified with symbols, while arbitrary precision are specified with an integer, determining the number of bits to use.',17))]),i[9]||(i[9]=a(`<div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">binary </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> multibodysystem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Msun&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, a</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;AU&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> simulate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(binary, t_sim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, save_everystep</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, precision</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:Double64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># will use Double64 precision (106 bits)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> simulate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(binary, t_sim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, save_everystep</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, precision</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">254</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># will use ArbFloat type with 254 bit precision</span></span></code></pre></div>`,1))])}const m=l(h,[["render",r]]);export{E as __pageData,m as default};
